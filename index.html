<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>User Records App</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="p-4">
  <h1>User Records</h1>

  <!-- Add User Form -->
  <div class="mb-4">
    <h4>Add New User</h4>
    <form id="addUserForm" class="row g-2">
      <div class="col-md-3">
        <input type="text" id="name" placeholder="Name" required class="form-control">
      </div>
      <div class="col-md-3">
        <input type="email" id="email" placeholder="Email" required class="form-control">
      </div>
      <div class="col-md-2">
        <input type="number" id="age" placeholder="Age" class="form-control">
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Add</button>
      </div>
    </form>
  </div>

  <!-- Users Table -->
  <table class="table table-bordered">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Age</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="userTableBody"></tbody>
  </table>

  <script>
    const apiUrl = "/records"; // Nginx proxies this to Spring Boot

    async function loadUsers() {
      const res = await fetch(apiUrl);
      const users = await res.json();
      const tbody = document.getElementById("userTableBody");
      tbody.innerHTML = "";
      users.forEach(user => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${user.id}</td>
          <td><input type="text" class="form-control" value="${user.name}" id="name-${user.id}"></td>
          <td><input type="email" class="form-control" value="${user.email}" id="email-${user.id}"></td>
          <td><input type="number" class="form-control" value="${user.age ?? ''}" id="age-${user.id}"></td>
          <td>
            <button class="btn btn-success btn-sm" onclick="updateUser(${user.id})">Update</button>
            <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function updateUser(id) {
      const user = {
        name: document.getElementById(`name-${id}`).value,
        email: document.getElementById(`email-${id}`).value,
        age: document.getElementById(`age-${id}`).value || null
      };
      await fetch(`${apiUrl}/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(user)
      });
      loadUsers();
    }

    async function deleteUser(id) {
      await fetch(`${apiUrl}/${id}`, { method: "DELETE" });
      loadUsers();
    }

    document.getElementById("addUserForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const user = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        age: document.getElementById("age").value || null
      };
      await fetch(apiUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(user)
      });
      e.target.reset();
      loadUsers();
    });

    loadUsers();
  </script>
</body>
</html>
